<?php\n/**\n * Chat Integration Helper\n * Bridges the advanced chat with existing TaskFlow AI system\n */\n\n// Ensure advanced chat is loaded\nif (!class_exists('AdvancedChatInterface')) {\n    require_once __DIR__ . '/features/advanced-chat.php';\n}\n\nclass ChatIntegration {\n    private $database;\n    private $advancedChat;\n    private $chatRoutes;\n    \n    public function __construct($database) {\n        $this->database = $database;\n        $this->advancedChat = new AdvancedChatInterface($database);\n        $this->chatRoutes = new AdvancedChatRoutes($this->advancedChat);\n    }\n    \n    public function handleAdvancedChatRoutes($method, $path, $input = []) {\n        // Match advanced chat routes\n        if (preg_match('#^/api/chat/(.+)$#', $path, $matches)) {\n            $endpoint = '/api/chat/' . $matches[1];\n            \n            try {\n                $result = $this->chatRoutes->handleRequest($method, $endpoint, $input);\n                if ($result !== null) {\n                    return ['success' => true, 'data' => $result];\n                } else {\n                    return ['success' => false, 'error' => 'Endpoint not found'];\n                }\n            } catch (Exception $e) {\n                return ['success' => false, 'error' => $e->getMessage()];\n            }\n        }\n        \n        return null; // Not an advanced chat route\n    }\n    \n    public function getAdvancedChatInterface() {\n        return $this->advancedChat;\n    }\n    \n    public function getChatRoutes() {\n        return $this->chatRoutes;\n    }\n    \n    /**\n     * Initialize advanced chat assets for frontend\n     */\n    public function renderChatAssets() {\n        return '\n        <!-- Advanced Chat Assets -->\n        <link rel=\"stylesheet\" href=\"/src/css/advanced-chat.css\">\n        <script src=\"/src/js/advanced-chat.js\"></script>\n        <script src=\"/src/js/mobile-enhancements.js\"></script>\n        ';\n    }\n    \n    /**\n     * Render enhanced chat interface HTML\n     */\n    public function renderAdvancedChatInterface() {\n        ob_start();\n        ?>\n        <!-- Advanced Chat Interface -->\n        <div id=\"chat\" class=\"chat-container\">\n            <div class=\"chat-header\">\n                <button class=\"chat-close\" onclick=\"toggleChat()\">\n                    <svg width=\"20\" height=\"20\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n                        <path d=\"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z\"/>\n                    </svg>\n                </button>\n                <h2 class=\"chat-title\">AI Assistant</h2>\n                <div class=\"chat-actions\">\n                    <button id=\"search-button\" class=\"chat-action\" title=\"Search History\">\n                        <svg width=\"20\" height=\"20\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path d=\"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z\"/>\n                        </svg>\n                    </button>\n                    <button id=\"shortcut-button\" class=\"chat-action\" title=\"Quick Shortcuts\">\n                        <svg width=\"20\" height=\"20\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path d=\"M2.5 4v3h5v12h3V7h5V4h-13zm19 5h-9v3h3v7h3v-7h3V9z\"/>\n                        </svg>\n                    </button>\n                </div>\n            </div>\n            \n            <!-- Voice Indicator -->\n            <div id=\"voice-indicator\" class=\"voice-indicator\">\n                ðŸŽ¤ Listening...\n            </div>\n            \n            <!-- Search Panel -->\n            <div id=\"search-panel\" class=\"search-panel\">\n                <input \n                    id=\"search-input\" \n                    class=\"search-input\" \n                    placeholder=\"Search chat history...\" \n                    oninput=\"advancedChat && advancedChat.searchHistory(this.value)\"\n                />\n                <div id=\"search-results\" class=\"search-results\"></div>\n            </div>\n            \n            <!-- Shortcut Panel -->\n            <div id=\"shortcut-panel\" class=\"shortcut-panel\"></div>\n            \n            <div id=\"chat-messages\" class=\"chat-messages\">\n                <div class=\"message ai\">\n                    <p>Hi! I\\'m your TaskFlow AI assistant with enhanced voice and shortcut capabilities.</p>\n                    <p><strong>Voice commands:</strong> Say \"new task\", \"search history\", or \"show shortcuts\"</p>\n                    <p><strong>Shortcuts:</strong> Type //t for tasks, //n for notes, //p for projects</p>\n                    <p><strong>Mobile:</strong> Swipe right to close, long-press for context menu</p>\n                </div>\n            </div>\n            \n            <div class=\"chat-input-container\">\n                <!-- Voice Preview -->\n                <div id=\"voice-preview\" class=\"voice-preview\"></div>\n                \n                <!-- Smart Suggestions -->\n                <div id=\"suggestions-container\" class=\"suggestions-container\"></div>\n                \n                <!-- Shortcut Preview -->\n                <div id=\"shortcut-preview\" class=\"shortcut-preview\"></div>\n                \n                <div class=\"chat-input-wrapper\">\n                    <textarea \n                        id=\"chat-input\" \n                        class=\"chat-input\" \n                        placeholder=\"Type your message or use voice...\" \n                        rows=\"1\"\n                        maxlength=\"1000\"\n                        autocomplete=\"off\"\n                        spellcheck=\"true\"\n                    ></textarea>\n                </div>\n                \n                <div class=\"chat-input-actions\">\n                    <button id=\"voice-button\" class=\"chat-input-btn\" title=\"Voice Input\">\n                        ðŸŽ¤\n                    </button>\n                </div>\n                \n                <button id=\"chat-send\" class=\"chat-send\" disabled>\n                    <svg width=\"20\" height=\"20\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n                        <path d=\"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z\"/>\n                    </svg>\n                </button>\n            </div>\n        </div>\n        <?php\n        return ob_get_clean();\n    }\n}\n\n?>